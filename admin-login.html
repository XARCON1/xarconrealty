<!DOCTYPE html>
<html lang="es-NI">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Acceso seguro para administradores de Xarcon Realty." />
  <title>XARCON REALTY | Admin Login</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <main class="section container">
    <section class="admin-auth-card">
      <h1>Ingreso administrativo</h1>
      <p>Este acceso es privado. Inicia sesión para abrir el dashboard.</p>
      <form id="admin-login-form" class="admin-form-grid">
        <label>
          Usuario
          <input id="admin-user" type="text" required autocomplete="username" />
        </label>
        <label>
          Contraseña
          <input id="admin-pass" type="password" required autocomplete="current-password" />
        </label>
        <button class="btn btn-primary" type="submit">Ingresar</button>
      </form>
      <p id="admin-login-status" class="admin-status"></p>
    </section>
  </main>

  <script>
    const ADMIN_AUTH_KEY = 'xarcon-admin-auth';
    const ADMIN_CREDENTIALS_HASH_KEY = 'xarcon-admin-credentials-hash';
    const textEncoder = new TextEncoder();

    const hashText = async (value) => {
      const digest = await crypto.subtle.digest('SHA-256', textEncoder.encode(value));
      return [...new Uint8Array(digest)].map((byte) => byte.toString(16).padStart(2, '0')).join('');
    };

    const getDefaultCredentialHash = async () => hashText('admin:Xarcon#2026');

    const getStoredCredentialHash = async () => {
      const stored = localStorage.getItem(ADMIN_CREDENTIALS_HASH_KEY);
      if (stored) return stored;
      const fallback = await getDefaultCredentialHash();
      localStorage.setItem(ADMIN_CREDENTIALS_HASH_KEY, fallback);
      return fallback;
    };

    if (sessionStorage.getItem(ADMIN_AUTH_KEY) === 'true') {
      window.location.replace('admin.html');
    }

    document.getElementById('admin-login-form').addEventListener('submit', async (event) => {
      event.preventDefault();
      const username = document.getElementById('admin-user').value.trim();
      const password = document.getElementById('admin-pass').value;
      const status = document.getElementById('admin-login-status');
      const enteredHash = await hashText(`${username}:${password}`);
      const expectedHash = await getStoredCredentialHash();

      if (enteredHash !== expectedHash) {
        status.textContent = 'Credenciales inválidas.';
        return;
      }

      sessionStorage.setItem(ADMIN_AUTH_KEY, 'true');
      window.location.replace('admin.html');
    });
  </script>
</body>
</html>
